# 使用flask-migrate进行数据模型变更

### 应用场景介绍
开发人员开发到一半，发现需要向原有的表增删列，或者添加索引。

比如`Goods`我想再加一列 `recommended_times` 表示被匹配推荐过的次数。

只需要修改`Goods.py`文件，在里面加一行 `recommended_times = db.Column(db.Integer(10))`

然后让`flask-migrate`将我对Goods模型修改反映到Goods数据库表修改，且希望这个过程不会影响`Goods`表内原有数据。


### STEP0：设置环境变量
unix中 `export FLASK_APP=manager.py`

windows中 `set FLASK_APP=manager.py`

### STEP1：直接修改model
比如在Goods内新增一个存储整数的列recommend_times,只需在文件内添加一行 `recommend_times = db.Column(db.Integer(10))`

>数据库数据类型与python数据类型的对应表

|  数据库类型名   | Python类型  | 说　明 |
|  :----:  |: ----:  |:----:|
|Integer | int  | 普通整数，通常是 32 位|
|SmallInteger| int| 取值范围小的整数，通常是 16 位|
|BigInteger| int 或 long| 不限制精度的整数|
|Float| float |浮点数|
|Numeric| decimal.Decimal| 定点数|
|String| str| 变长字符串|
|Text| str| 变长字符串，对较长或不限长度的字符串做了优化|
|Unicode| unicode| 变长 Unicode 字符串|
|UnicodeText| unicode| 变长Unicode 字符串，对较长或不限长度的字符串 做了优化|
|Boolean| bool| 布尔值|
|Date| datetime.date| 日期|
|Time| datetime.time| 时间|
|DateTime| datetime.datetime| 日期和时间|
|Interval| datetime.timedelta| 时间间隔|
|Enum| str| 一组字符串|
|PickleType| 任何 Python 对象| 自动使用 Pickle 序列化|
|LargeBinary| str| 二进制 blob|

### STEP2：生成数据库迁移脚本(将对模型的修改应用到数据库表的修改且不影响数据)
`flask db migrate -m "新增匹配次数列"`

### STEP3：运行生成的迁移脚本
`flask db upgrade`

### STEP4: 不满意修改，想回滚
`flask db downgrade`